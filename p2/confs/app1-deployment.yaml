apiVersion: apps/v1
kind: Deployment
metadata:
  name: app-one
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app: app-one
  template:
    metadata:
      labels:
        app: app-one
    spec:
      containers:
      - name: app-one
        image: nginx:alpine
        ports:
        - containerPort: 80
        env:
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        command: ["/bin/sh", "-c"]
        args:
          - |
            ARCH=$(uname -m)
            OS=$(uname -s | tr '[:upper:]' '[:lower:]')
            cp /usr/share/nginx/html-template/index.html /usr/share/nginx/html/index.html
            sed -i "s/POD_NAME_PLACEHOLDER/${POD_NAME}/g" /usr/share/nginx/html/index.html
            sed -i "s/NODE_NAME_PLACEHOLDER/${NODE_NAME} (${OS}\/${ARCH})/g" /usr/share/nginx/html/index.html
            nginx -g 'daemon off;'
        volumeMounts:
        - name: html-template
          mountPath: /usr/share/nginx/html-template
      volumes:
      - name: html-template
        configMap:
          name: app1-html
---
apiVersion: v1
kind: Service
metadata:
  name: app1-service
  namespace: default
spec:
  selector:
    app: app-one
  ports:
  - port: 80
    targetPort: 80
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: app1-html
  namespace: default
data:
  index.html: |
    <!DOCTYPE html>
    <html>
      <head>
        <title>Hello Kubernetes!</title>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300">
        <style>
          body {
            font-family: 'Ubuntu', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
          }
          .main {
            background: white;
            padding: 50px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 600px;
          }
          .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
          }
          .logo-text {
            font-size: 48px;
            font-weight: 300;
            color: #326CE5;
            letter-spacing: -1px;
          }
          .content {
            margin-top: 30px;
          }
          #message {
            font-size: 32px;
            font-weight: 300;
            margin: 30px 0;
            color: #333;
          }
          #info {
            margin-top: 30px;
          }
          table {
            margin: 0 auto;
            text-align: left;
            border-collapse: collapse;
          }
          td {
            padding: 10px 20px;
            font-size: 18px;
          }
          td:first-child {
            color: #666;
            font-weight: 300;
          }
          b {
            color: #667eea;
            font-weight: 400;
          }
        </style>
      </head>
      <body>
        <div class="main">
          <div class="logo-container">
                      <svg width="120" height="120" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
                        <g transform="translate(256,256)">
                          <path d="M 0,-230 L 199.186,-115 L 199.186,115 L 0,230 L -199.186,115 L -199.186,-115 Z" 
                                fill="#326CE5" 
                                stroke="#FFF" 
                                stroke-width="8"/>
                          <g fill="#FFF">
                            <circle cx="0" cy="0" r="25"/>
                            <g id="spoke">
                              <rect x="-8" y="-100" width="16" height="75" rx="8"/>
                              <circle cx="0" cy="-100" r="18"/>
                            </g>
                            <use href="#spoke" transform="rotate(45)"/>
                            <use href="#spoke" transform="rotate(90)"/>
                            <use href="#spoke" transform="rotate(135)"/>
                            <use href="#spoke" transform="rotate(180)"/>
                            <use href="#spoke" transform="rotate(225)"/>
                            <use href="#spoke" transform="rotate(270)"/>
                            <use href="#spoke" transform="rotate(315)"/>
                          </g>
                        </g>
                      </svg>
                      <span class="logo-text">kubernetes</span>
                  </div>
          <div class="content">
            <div id="message">
              Hello from app1
            </div>
            <div id="info">
              <table>
                <tr>
                  <td>pod:</td>
                  <td><b>POD_NAME_PLACEHOLDER</b></td>
                </tr>
                <tr>
                  <td>node:</td>
                  <td><b>NODE_NAME_PLACEHOLDER</b></td>
                </tr>
              </table>
            </div>
          </div>
        </div>
      </body>
    </html>